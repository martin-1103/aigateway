openapi: 3.0.3
info:
  title: AIGateway
  version: 1.0.0

x-api-map:
  # AI Model Endpoints
  proxy:
    file: paths/proxy.yaml
    endpoints:
      - POST /v1/messages           # Anthropic format
      - POST /v1/chat/completions   # OpenAI format

  models:
    file: paths/models.yaml
    endpoints:
      - GET /v1/models              # List available models

  # Authentication
  auth:
    file: paths/auth.yaml
    endpoints:
      - POST /api/v1/auth/login     # Login, get JWT
      - GET  /api/v1/auth/me        # Get current user
      - PUT  /api/v1/auth/password  # Change password

  # User Management (Admin only)
  users:
    file: paths/users.yaml
    endpoints:
      - GET    /api/v1/users
      - POST   /api/v1/users
      - GET    /api/v1/users/{id}
      - PUT    /api/v1/users/{id}
      - DELETE /api/v1/users/{id}

  # API Key Management
  apikeys:
    file: paths/apikeys.yaml
    endpoints:
      - GET    /api/v1/api-keys
      - POST   /api/v1/api-keys
      - DELETE /api/v1/api-keys/{id}

  # Account Management
  accounts:
    file: paths/accounts.yaml
    endpoints:
      - GET    /api/v1/accounts
      - POST   /api/v1/accounts
      - GET    /api/v1/accounts/{id}
      - PUT    /api/v1/accounts/{id}
      - DELETE /api/v1/accounts/{id}

  # Proxy Pool Management (Admin only)
  proxies:
    file: paths/proxies.yaml
    endpoints:
      - GET    /api/v1/proxies
      - POST   /api/v1/proxies
      - GET    /api/v1/proxies/{id}
      - PUT    /api/v1/proxies/{id}
      - DELETE /api/v1/proxies/{id}
      - GET    /api/v1/proxies/assignments
      - POST   /api/v1/proxies/recalculate

  # Model Mappings
  model-mappings:
    file: paths/model-mappings.yaml
    endpoints:
      - GET    /api/v1/model-mappings
      - POST   /api/v1/model-mappings
      - GET    /api/v1/model-mappings/{alias}
      - PUT    /api/v1/model-mappings/{alias}
      - DELETE /api/v1/model-mappings/{alias}

  # OAuth Flow
  oauth:
    file: paths/oauth.yaml
    endpoints:
      - GET  /api/v1/oauth/providers  # List OAuth providers
      - POST /api/v1/oauth/init       # Start OAuth flow
      - GET  /api/v1/oauth/callback   # OAuth callback (HTML)
      - POST /api/v1/oauth/exchange   # Manual flow exchange
      - POST /api/v1/oauth/refresh    # Refresh token

  # Statistics
  stats:
    file: paths/stats.yaml
    endpoints:
      - GET /api/v1/stats/proxies/{id}
      - GET /api/v1/stats/logs

  # Provider Info
  providers:
    file: paths/providers.yaml
    endpoints:
      - GET /api/v1/providers

  # Health Check
  health:
    file: paths/health.yaml
    endpoints:
      - GET /health

x-schemas:
  account: schemas/account.yaml
  proxy: schemas/proxy.yaml
  provider: schemas/provider.yaml
  user: schemas/user.yaml
  apikey: schemas/apikey.yaml
  model-mapping: schemas/model-mapping.yaml
  common: schemas/common.yaml
